<:wrap admin/base.tmpl title=>[cat "Manage " [cond [article parentid] [typename article] Site] " Images"] :>
<div class="window">
  <header>
    <h1><:param title:></h1>
    <:- if Article parentid:>
<:include admin/include/toolbar_article.tmpl:>
    <:- or Article:>
<:include admin/include/toolbar_site.tmpl:>
    <:- eif Article:>
  </header>
  <form action="<:script:>" method="post" enctype="multipart/form-data" data-object="Image">
    <input type="hidden" name="id" value="<:article id:>" />
    <input type="hidden" name="_t" value="img" />
    <input type="hidden" name="r" value="
    <:- switch -:>

    <:- # from aywhere: refresh to supplied r param -:>
    <:- case Cgi r -:>
    <:cgi r:>

    <:- # from preview with referer: refresh to article preview on save changes -:>
    <:- case And [cgi referer] [ifMatch [referer] [adminurl admin]] -:>
    <:adminurl add id [cgi referer] preview 1:>

    <:- # from preview: refresh to article preview on save changes -:>
    <:- case ifMatch [referer] [adminurl admin] -:>
    <:adminurl add id [article id] preview 1:>

    <:- endswitch -:>
    " />
    <:- if Images:>
    <:csrfp admin_save_images hidden:>
    <:csrfp admin_add_image hidden:>
    <:- iterator begin images:>
    <div class="object">
      <h2>Image <:image_number:> <:ifUserCan bse_edit_images_reorder:article:><:imgmove:><:or:><:eif:></h2>
      <p class="buttons">
        <:- if UserCan bse_edit_images_delete:article:>
        <a href="<:script:>?removeimg_<:image id:>=1&amp;id=<:article id:>&amp;_csrfp=<:csrfp admin_remove_image:>&amp;r=<:script:>%3Fid=<:article id:>%26_t=img" data-action="Delete" data-object="Image" class="button red small">Delete</a>
        <:- or UserCan:>
        <a class="button red small disabled">Delete</a>
        <:- eif UserCan:>
      </p>
      <fieldset>
        <legend>Resource</legend>
        <div>
          <label for="image<:image id:>">Change image <:error_img [concatenate image [image id]]:></label>
          <span>
            <input type="file" name="image<:image id:>" id="image<:image id:>" class="<:ifError_img [concatenate image [image id]]:>error<:or:><:eif:>" />
            <:help image image:>
          </span>
        </div>
        <div>
          <label for="name<:image id:>">Name <:ifEq [article id] -1:><span class="required">*</span> <:or:><:eif:><:error_img [concatenate name [image id]]:></label>
          <span>
            <input type="text" name="name<:image id:>" id="name<:image id:>" value="<:oldi [concatenate name [image id]] 0 image name:>" <:ifEq [article id] -1:> required="required" <:or:><:eif:>class="<:ifError_img [concatenate name [image id]]:>error<:or:><:eif:>" />
            <:help image name:>
          </span>
        </div>
        <div>
          <label>Thumbnail</label>
          <span>
            <a href="<:image src:>"><:thumbimage editor:></a>
          </span>
        </div>
        <div>
          <label>Original</label>
          <span>
            <a href="<:image src:>"><:replace [image image] ^[0-9]+_ :></a>
          </span>
        </div>
        <div>
          <label>Size</label>
          <span>
            <:image width:> &times; <:image height:> px
          </span>
        </div>
      </fieldset>
      <details>
        <summary>More attributes</summary>
        <fieldset>
          <legend>Properties</legend>
          <div>
            <label for="alt<:image id:>">Alt <:error_img [concatenate alt [image id]]:></label>
            <span>
              <input type="text" name="alt<:image id:>" id="alt<:image id:>" value="<:oldi [concatenate alt [image id]] 0 image alt:>" class="<:ifError_img [concatenate alt [image id]]:>error<:or:><:eif:>" />
              <:help image alt:>
            </span>
          </div>
          <div>
            <label for="url<:image id:>">URL <:error_img [concatenate url [image id]]:></label>
            <span>
              <input type="text" name="url<:image id:>" id="url<:image id:>" value="<:oldi [concatenate url [image id]] 0 image url:>" class="<:ifError_img [concatenate url [image id]]:>error<:or:><:eif:>" />
              <:help image url:>
            </span>
          </div>
          <div>
            <label for="storage<:image id:>">Storage <:error_img [concatenate storage [image id]]:></label>
            <span>
              <select name="storage<:image id:>" id="storage<:image id:>">
                <option value="">(Auto)</option>
                <:- iterator begin image_stores:>
                <option value="<:image_store name:>" <:ifEq [oldi [concatenate storage [image id]] 0 image storage] [image_store name]:>selected="selected"<:or:><:eif:>><:image_store description:></option>
                <:- iterator end image_stores:>
              </select>
              <:help image storage:>
            </span>
          </div>
        </fieldset>
      </details>
    </div>
    <:- iterator end images:>
    <:- or Images:>
    <fieldset>
      <legend>Images</legend>
      <div class="center">
        <p><img src="/bse-admin/images/icons/alert.png" /></p>
        <p>No images to display</p>
        <:- if UserCan bse_edit_images_add:article:>
        <p><a href="<:script:>?id=<:article id:>&amp;_t=imgupload&amp;referer=1" data-icon="add" class="button white">New Imageâ€¦</a></p>
        <:- or UserCan:><:eif UserCan:>
      </div>
    </fieldset>
    <:- eif Images:>
    <p class="buttons">
      <a href="<:switch:><:case Match [referer] [adminurl admin]:><:adminurl add id [cond [cgi referer] [cgi referer] [article id]] preview 1:><:case And [cgi referer] [referer]:><:replace [referer] "&amp;referer=[0-9]+":><:case default:><:script:>?id=<:article id:><:endswitch:>" accesskey="." title="AccessKey = ." class="button white">Done</a>
      <:- if And [ifImages] [ifUserCan bse_edit_images_save:article]:>
      <input type="submit" name="process" value="Save Changes" accesskey="s" title="AccessKey = s" class="button green" />
      <:- or And:><:eif And:>
    </p>
  </form>
</div>